<ion-header>
  <ion-toolbar>
    <ion-title>Welcome to Language Learning</ion-title>
    <!-- <ion-buttons slot="end">
      <ion-button (click)="skipOnboarding()" fill="clear">
        Skip
      </ion-button>
    </ion-buttons> -->
    <ion-buttons slot="end">
        <ion-button (click)="logout()" fill="clear">
          Logout
        </ion-button>
      </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="onboarding-container">
    <!-- Progress Bar -->
    <div class="progress-section">
      <ion-progress-bar [value]="getProgressPercentage() / 100"></ion-progress-bar>
      <p class="step-indicator">Step {{ currentStep }} of {{ totalSteps }}</p>
    </div>

    <!-- Step 1: Name -->
    <div *ngIf="currentStep === 1" class="step-content">
      <div class="name-section">
        <ion-icon name="person" size="large" color="primary"></ion-icon>
        <h2>What's your name?</h2>
        <p>Let's start with the basics</p>
        
        <ion-item class="name-input">
          <ion-label position="stacked">First Name</ion-label>
          <ion-input 
            [(ngModel)]="firstName" 
            placeholder="Enter your first name"
            type="text"
            required>
          </ion-input>
        </ion-item>
        
        <ion-item class="name-input">
          <ion-label position="stacked">Last Name</ion-label>
          <ion-input 
            [(ngModel)]="lastName" 
            placeholder="Enter your last name"
            type="text"
            required>
          </ion-input>
        </ion-item>
      </div>
    </div>

    <!-- Step 2: Native Language Selection -->
    <div *ngIf="currentStep === 2" class="step-content">
      <div class="native-language-section">
        <ion-icon name="language" size="large" color="primary"></ion-icon>
        <h2>What's your native language?</h2>
        <p>We'll provide lesson feedback in your language</p>
        
        <div class="language-grid">
          <ion-chip 
            *ngFor="let lang of nativeLanguageOptions" 
            [class.selected]="nativeLanguage === lang.code"
            (click)="setNativeLanguage(lang.code)">
            <span class="language-native">{{ lang.native }}</span>
            <span class="language-name">({{ lang.name }})</span>
          </ion-chip>
        </div>
      </div>
    </div>

    <!-- Step 3: Language Selection -->
    <div *ngIf="currentStep === 3" class="step-content">
      <h2>What languages would you like to learn?</h2>
      <p>Select all that interest you:</p>
      
      <div class="language-grid">
        <ion-chip 
          *ngFor="let language of availableLanguages" 
          [class.selected]="selectedLanguages.includes(language)"
          (click)="toggleLanguage(language)">
          {{ language }}
        </ion-chip>
      </div>
    </div>

    <!-- Step 4: Learning Goals (Students Only) -->
    <div *ngIf="currentStep === 4 && !isTutorOnboarding()" class="step-content">
      <h2>What are your learning goals?</h2>
      <p>Choose what you want to achieve:</p>
      
      <div class="goals-list">
        <ion-item 
          *ngFor="let goal of availableGoals" 
          button 
          (click)="toggleGoal(goal)"
          [class.selected]="learningGoals.includes(goal)">
          <ion-checkbox 
            slot="start" 
            [checked]="learningGoals.includes(goal)">
          </ion-checkbox>
          <ion-label>{{ goal }}</ion-label>
        </ion-item>
      </div>
    </div>

    <!-- Step 5: Experience & Schedule (Students Only) -->
    <div *ngIf="currentStep === 5 && !isTutorOnboarding()" class="step-content">
      <h2>Tell us about your experience</h2>
      
      <div class="experience-section">
        <h3>What's your current level?</h3>
        <div class="level-options">
          <ion-button 
            *ngFor="let level of experienceLevels" 
            [fill]="experienceLevel === level ? 'solid' : 'outline'"
            (click)="setExperienceLevel(level)">
            {{ level }}
          </ion-button>
        </div>
      </div>

      <div class="schedule-section">
        <h3>How often would you like to practice?</h3>
        <div class="schedule-options">
          <ion-button 
            *ngFor="let schedule of scheduleOptions" 
            [fill]="preferredSchedule === schedule ? 'solid' : 'outline'"
            (click)="setPreferredSchedule(schedule)">
            {{ schedule }}
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Step 3: Tutor-specific steps (Tutors Only) -->
    <div *ngIf="currentStep === 3 && isTutorOnboarding()" class="step-content">
      <h2>Complete your tutor profile</h2>
      
      <!-- Tutor Country -->
      <div class="tutor-country-section">
        <h3>Where are you from?</h3>
        <p class="section-hint">This helps students find tutors from specific regions</p>
        <ion-item class="country-select-item">
          <ion-label position="stacked">Country</ion-label>
          <ion-button 
            fill="outline" 
            expand="block"
            (click)="openCountryModal()"
            class="country-select-button">
            <span *ngIf="tutorCountry; else noCountrySelected" style="display: flex; align-items: center; gap: 8px;">
              <app-flag-icon [country]="tutorCountry" [size]="20"></app-flag-icon>
              <span>{{ tutorCountry }}</span>
            </span>
            <ng-template #noCountrySelected>
              Select your country
            </ng-template>
            <ion-icon name="chevron-down" slot="end"></ion-icon>
          </ion-button>
        </ion-item>
      </div>
      
      <!-- Tutor Experience -->
      <div class="tutor-experience-section">
        <h3>Teaching Experience</h3>
        <div class="experience-options">
          <ion-button 
            *ngFor="let experience of tutorExperienceOptions" 
            [fill]="tutorExperience === experience ? 'solid' : 'outline'"
            (click)="setTutorExperience(experience)">
            {{ experience }}
          </ion-button>
        </div>
      </div>

      <!-- Tutor Schedule -->
      <div class="tutor-schedule-section">
        <h3>When are you available?</h3>
        <div class="schedule-options">
          <ion-button 
            *ngFor="let schedule of tutorScheduleOptions" 
            [fill]="tutorSchedule === schedule ? 'solid' : 'outline'"
            (click)="setTutorSchedule(schedule)">
            {{ schedule }}
          </ion-button>
        </div>
      </div>

      <!-- Tutor Bio -->
      <div class="tutor-bio-section">
        <h3>Tell students about yourself</h3>
        <ion-textarea
          [(ngModel)]="tutorBio"
          placeholder="Write a brief description of your teaching style, background, and what students can expect from your lessons..."
          rows="4"
          maxlength="1000">
        </ion-textarea>
        <p class="character-count">{{ tutorBio.length }}/1000 characters</p>
      </div>

      <!-- Lesson Rate -->
      <div class="hourly-rate-section">
        <h3>Set your lesson rate</h3>
        <p style="font-size: 14px; color: #64748b; margin: 8px 0 16px 0;">This is your rate for a standard 50-minute lesson</p>
        <div class="rate-input">
          <ion-label>$</ion-label>
          <ion-input
            type="number"
            [(ngModel)]="tutorHourlyRate"
            min="5"
            max="200"
            placeholder="25">
          </ion-input>
          <ion-label>/hour</ion-label>
        </div>
        <p class="rate-hint">Recommended: $15-50 per hour</p>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="navigation-buttons">
      <ion-button 
        *ngIf="currentStep > 1" 
        fill="outline" 
        (click)="previousStep()">
        Previous
      </ion-button>
      
      <ion-button 
        expand="block" 
        [disabled]="!canProceed()"
        (click)="nextStep()">
        {{ currentStep === totalSteps ? 'Complete Setup' : 'Next' }}
      </ion-button>
    </div>
  </div>
</ion-content>
